<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NL Payroll Automation</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header>
    <h1>NL Payroll Automation</h1>
    <nav class="tabs">
      <button data-tab="dashboard" class="active">Dashboard</button>
      <button data-tab="employees">Employees</button>
      <button data-tab="offboarding">Offboarding</button>
      <button data-tab="runs">Payroll Runs</button>
      <button data-tab="compliance">Compliance</button>
      <button data-tab="mock-services">Mock Services</button>
      <button data-tab="audit">Audit Log</button>
      <button data-tab="settings">Settings</button>
      <button data-tab="command">Command Center</button>
    </nav>
  </header>

  <main>
    <section id="dashboard" class="tab active">
      <div class="card">
        <h2>Snapshot</h2>
        <div id="snapshot"></div>
      </div>
      <div class="card" id="headcountPulse">
        <h3>Headcount pulse</h3>
        <div class="pulse-grid">
          <div>
            <span class="pulse-value" id="pulseTotal">0</span>
            <span class="pulse-label">Total employees</span>
          </div>
          <div>
            <span class="pulse-value" id="pulseFinance">0</span>
            <span class="pulse-label">Finance</span>
          </div>
          <div>
            <span class="pulse-value" id="pulseTech">0</span>
            <span class="pulse-label">Technology</span>
          </div>
          <div>
            <span class="pulse-value" id="pulseHr">0</span>
            <span class="pulse-label">HR & People</span>
          </div>
        </div>
      </div>
      <div class="grid">
        <div class="card">
          <h3>Quick actions</h3>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <button id="qaPreview">Preview current month</button>
            <button id="qaSepa" class="secondary">Generate SEPA XML</button>
            <button id="qaCreateRun" class="secondary" onclick="document.querySelector('button[data-tab=\"runs\"]').click()">Create Payroll Run</button>
          </div>
          <div id="qaStatus" class="muted" style="margin-top:12px;"></div>
        </div>
        <div class="card">
          <h3>Notes on NL rules</h3>
          <ul style="line-height:1.8;">
            <li>Holiday allowance is typically 8 percent.</li>
            <li>Minimum statutory vacation equals four times weekly hours per year.</li>
            <li>Unused vacation on termination must be paid out.</li>
            <li>Transition allowance: 1/3 monthly salary per year of service (mandatory for dismissals).</li>
            <li>30% ruling: Maximum 5 years, expires automatically.</li>
          </ul>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <h3>System Status</h3>
        <div class="grid two">
          <div>
            <strong>Scheduler:</strong> <span class="success">●</span> Running (runs on 25th of each month)
          </div>
          <div>
            <strong>Data Storage:</strong> <span class="info">●</span> In-Memory (10 employees)
          </div>
          <div>
            <strong>Mock Services:</strong> <span class="success">●</span> Active
          </div>
          <div>
            <strong>Audit Logging:</strong> <span class="success">●</span> Enabled
          </div>
        </div>
      </div>
    </section>

    <section id="employees" class="tab">
      <div class="card">
        <h2>Add a new employee</h2>
        <form id="empCreateForm" class="grid two">
          <label>First name<input name="firstName" required /></label>
          <label>Last name<input name="lastName" required /></label>
          <label>Email<input name="email" type="email" required /></label>
          <label>Start date<input name="startDate" type="date" required /></label>
          <label>Annual salary (€)<input name="annualSalaryEuros" type="number" min="0" step="100" required /></label>
          <label>Hours per week<input name="hoursPerWeek" type="number" min="1" step="1" required /></label>
          <label>Working days per week<input name="workingDaysPerWeek" type="number" min="1" max="5" step="0.5" required /></label>
          <label>Department<input name="department" required /></label>
          <label>Role<input name="role" required /></label>
          <label>Location<input name="location" required /></label>
          <label>Contract type
            <select name="contractType" required>
              <option value="permanent">Permanent</option>
              <option value="fixed-term">Fixed term</option>
              <option value="contractor">Contractor</option>
            </select>
          </label>
          <label>Holiday days per year<input name="holidayDaysPerYear" type="number" min="1" step="0.5" value="25" /></label>
          <label class="checkbox"><input type="checkbox" name="isThirtyPercentRuling" /> Eligible for 30% ruling</label>
          <div class="form-actions">
            <button type="submit">Create employee</button>
            <span id="empCreateStatus" class="muted small"></span>
          </div>
        </form>
      </div>
      <div class="card">
        <div class="row">
          <h2>Employees</h2>
          <input id="search" placeholder="Search name or email" style="flex:1;max-width:300px;" />
        </div>
        <table id="empTable">
          <thead>
            <tr>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Start</th>
              <th>Salary</th>
              <th>Hours per week</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="offboarding" class="tab">
      <div class="card">
        <h2>Offboarding payout designer</h2>
        <div class="grid two offboarding-grid">
          <div>
            <label>Employee
              <select id="offEmployee"></select>
            </label>
            <label>Exit date
              <input id="offExitDate" type="date" />
            </label>
            <label>Primary Reason
              <select id="offPrimaryReason" required>
                <option value="">Select...</option>
                <option value="termination">Termination</option>
                <option value="resignation">Resignation</option>
              </select>
            </label>
            <label>Secondary Reason
              <select id="offSecondaryReason">
                <option value="">Select...</option>
                <option value="misconduct">Misconduct</option>
                <option value="end-of-contract">End of contract</option>
                <option value="mutual-agreement">Mutual agreement</option>
                <option value="redundancy">Redundancy</option>
                <option value="retirement">Retirement</option>
                <option value="other">Other</option>
              </select>
            </label>
            <button id="offCalculate">Generate offboarding plan</button>
            <button id="offExportExcel" class="secondary" style="margin-top:8px;">Export to Excel</button>
            <p class="muted small">Outputs include statutory Dutch transition allowance, vacation payout and notice compensation. Includes looncode mapping for government reporting.</p>
          </div>
          <div id="offSummary" class="offboarding-summary">
            <p class="muted">Select an employee to generate a payout package.</p>
          </div>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <h3>Termination payout calculator</h3>
        <p class="muted small">Calculate vacation payout for termination scenarios</p>
        <div class="grid two">
          <div>
            <label>Employee</label>
            <select id="termEmployee"></select>
          </div>
          <div>
            <label>Termination date</label>
            <input id="termDate" type="date" />
          </div>
          <div>
            <label>Holiday days per year</label>
            <input id="termDaysPerYear" type="number" step="0.5" />
          </div>
          <div>
            <label>Used holiday days YTD</label>
            <input id="termUsedDays" type="number" step="0.5" />
          </div>
        </div>
        <button id="calcTermBtn">Calculate</button>
        <div id="termResult"></div>
        <p class="muted small">
          Assumes payout equals remaining vacation hours at last hourly wage plus 8 percent holiday allowance. Numbers are gross.
        </p>
      </div>
    </section>

    <section id="runs" class="tab">
      <div class="card">
        <h2>Payroll Runs</h2>
        <p class="muted small">Create, approve, and manage monthly payroll runs. SEPA files are generated automatically.</p>
        <div class="row">
          <input id="month" type="month" style="flex:1;" />
          <button id="btnCreateRun" class="success">Create Payroll Run</button>
          <button id="btnPreview" class="secondary">Preview</button>
          <button id="btnSepa" disabled>Generate SEPA XML</button>
        </div>
        <div id="status" class="muted" style="margin-top:8px;"></div>
      </div>
      <div class="card">
        <h3>Payroll Run History</h3>
        <p class="muted small">All payroll runs with status and totals</p>
        <table id="payrollRunsTable">
          <thead>
            <tr>
              <th>Month</th>
              <th>Status</th>
              <th>Employees</th>
              <th>Total Gross</th>
              <th>Total Net</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="7" class="muted">Loading payroll runs...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="card">
        <h3>Payroll Preview</h3>
        <p class="muted small">Detailed breakdown for selected month with full gross-to-net calculation</p>
        <table id="employeesTable">
          <thead>
            <tr>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Gross</th>
              <th>Taxable</th>
              <th>Wage Tax</th>
              <th>Tax Credit</th>
              <th>Social Sec</th>
              <th>Pension</th>
              <th>Net</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="compliance" class="tab">
      <div class="card">
        <h2>Compliance & Reporting</h2>
        <p class="muted small">Dutch payroll compliance tools: pension, health insurance, jaaropgave, tax filings, and Loonaangifte</p>
        <div class="grid two">
          <div class="card">
            <h3>Pension Contributions</h3>
            <p class="muted small">Calculate monthly pension contributions for all employees</p>
            <button id="btnPensionMonthly">Calculate Monthly Pension</button>
            <div id="pensionResults" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Health Insurance</h3>
            <p class="muted small">Calculate monthly health insurance premiums</p>
            <button id="btnHealthInsurance">Calculate Health Insurance</button>
            <div id="healthInsuranceResults" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Year-End Statements (Jaaropgave)</h3>
            <p class="muted small">Generate annual tax statements for employees</p>
            <label style="display:block;margin-bottom:8px;">Employee
              <select id="jaaropgaveEmployee" style="width:100%;margin-top:4px;"></select>
            </label>
            <div class="row">
              <input id="jaaropgaveYear" type="number" placeholder="Year" value="2024" style="flex:1;" />
              <button id="btnGenerateJaaropgave" class="secondary">Generate</button>
            </div>
            <div class="row" style="margin-top:8px;">
              <button id="btnGenerateAllJaaropgave" style="flex:1;">Generate All for Year</button>
            </div>
            <div id="jaaropgaveResults" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Tax Filing (Loonaangifte)</h3>
            <p class="muted small">Generate and submit monthly payroll tax returns</p>
            <div class="row">
              <input id="taxFilingMonth" type="month" style="flex:1;" />
              <button id="btnGenerateTaxFiling">Generate</button>
            </div>
            <div id="taxFilingResults" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Loonaangifte (Offline)</h3>
            <p class="muted small">Generate monthly Loonaangifte XML files with validation. Fully offline - no Digipoort submission.</p>
            <div class="row">
              <input id="loonaangifteMonth" type="month" style="flex:1;" />
              <button id="btnCreateLoonaangifteBatch">Create Batch</button>
            </div>
            <div id="loonaangifteBatches" style="margin-top:16px;"></div>
            <div id="loonaangifteResults" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="mock-services" class="tab">
      <div class="card">
        <h2>Mock Services</h2>
        <p class="muted small">Simulated external integrations - all data stored in-memory. Ready for real integrations later.</p>
        <div class="grid two">
          <div class="card">
            <h3>Bank Submissions</h3>
            <p class="muted small">View payment submissions to bank</p>
            <button id="btnViewBankSubmissions">View Submissions</button>
            <div id="bankSubmissions" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Pension Provider</h3>
            <p class="muted small">View pension contribution submissions</p>
            <button id="btnViewPensionSubmissions">View Submissions</button>
            <div id="pensionSubmissions" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Health Insurance</h3>
            <p class="muted small">View health insurance submissions</p>
            <button id="btnViewInsuranceSubmissions">View Submissions</button>
            <div id="insuranceSubmissions" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Tax Authority (Belastingdienst)</h3>
            <p class="muted small">View tax filing submissions</p>
            <button id="btnViewTaxFilings">View Tax Filings</button>
            <div id="taxFilings" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>Email Service</h3>
            <p class="muted small">View email notifications</p>
            <button id="btnViewEmails">View Emails</button>
            <div id="emails" style="margin-top:16px;"></div>
          </div>
          <div class="card">
            <h3>HR System Sync</h3>
            <p class="muted small">Sync employee data from HR system</p>
            <div class="row">
              <button id="btnSyncHr" style="flex:1;">Sync HR System</button>
              <button id="btnViewHrSyncs" class="secondary">View History</button>
            </div>
            <div id="hrSyncs" style="margin-top:16px;"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="audit" class="tab">
      <div class="card">
        <h2>Audit Log</h2>
        <p class="muted small">Track all system events and changes for compliance and debugging</p>
        <div class="row">
          <input id="auditEventType" placeholder="Filter by event type (e.g., payroll_run_created)" style="flex:1;" />
          <button id="btnRefreshAudit" class="secondary">Refresh</button>
          <button id="btnRecentAudit" class="secondary">Recent 50</button>
        </div>
        <table id="auditLogTable">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>Event Type</th>
              <th>User</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>


    <section id="settings" class="tab">
      <div class="card">
        <h2>Company settings</h2>
        <div id="company"></div>
      </div>
      <div class="card">
        <h2>Rates Management</h2>
        <p class="muted small">Manage tax tables, social security rates, minimum wage, and pension schemes with period-based validity windows.</p>
        <div class="grid two">
          <div>
            <h3>Tax Tables</h3>
            <button id="btnViewTaxTables" class="secondary">View Tax Tables</button>
            <button id="btnAddTaxTable" class="secondary">Add Tax Table</button>
            <div id="taxTablesList" style="margin-top:16px;"></div>
          </div>
          <div>
            <h3>Social Security Rates</h3>
            <button id="btnViewSocialSecurity" class="secondary">View Rates</button>
            <button id="btnAddSocialSecurity" class="secondary">Add Rates</button>
            <div id="socialSecurityList" style="margin-top:16px;"></div>
          </div>
          <div>
            <h3>Minimum Wage</h3>
            <button id="btnViewMinimumWage" class="secondary">View Minimum Wages</button>
            <button id="btnAddMinimumWage" class="secondary">Add Minimum Wage</button>
            <div id="minimumWageList" style="margin-top:16px;"></div>
          </div>
          <div>
            <h3>Pension Schemes</h3>
            <button id="btnViewPensionSchemes" class="secondary">View Schemes</button>
            <button id="btnAddPensionScheme" class="secondary">Add Scheme</button>
            <div id="pensionSchemesList" style="margin-top:16px;"></div>
          </div>
        </div>
        <div class="card" style="margin-top:16px;">
          <h3>Period Coverage Check</h3>
          <p class="muted small">Check if all required rates are available for a period range</p>
          <div class="row">
            <input id="coverageStart" type="date" style="flex:1;" />
            <input id="coverageEnd" type="date" style="flex:1;" />
            <button id="btnCheckCoverage" class="secondary">Check Coverage</button>
          </div>
          <div id="coverageResult" style="margin-top:16px;"></div>
        </div>
        <div class="card" style="margin-top:16px;">
          <h3>Import Tax Tables</h3>
          <p class="muted small">Import tax tables from Excel file (e.g., wit_mnd_nl_std format)</p>
          <div style="margin-bottom:8px;">
            <label style="display:block; margin-bottom:4px;">Period Start (YYYY-MM-DD):</label>
            <input type="date" id="taxTablePeriodStart" style="width:100%; padding:4px;" />
          </div>
          <div style="margin-bottom:8px;">
            <label style="display:block; margin-bottom:4px;">Period End (YYYY-MM-DD):</label>
            <input type="date" id="taxTablePeriodEnd" style="width:100%; padding:4px;" />
          </div>
          <div style="margin-bottom:8px;">
            <label style="display:block; margin-bottom:4px;">Table Type:</label>
            <select id="taxTableType" style="width:100%; padding:4px;">
              <option value="loonheffing">Loonheffing</option>
              <option value="loonheffing_korting">Loonheffing Korting</option>
              <option value="loonheffing_arbeidskorting">Loonheffing Arbeidskorting</option>
            </select>
          </div>
          <div style="margin-bottom:8px;">
            <label style="display:block; margin-bottom:4px;">Tax Year (optional):</label>
            <input type="number" id="taxTableYear" min="2000" max="2100" style="width:100%; padding:4px;" />
          </div>
          <input type="file" id="taxTableFileInput" accept=".xlsx,.xls" style="margin-bottom:8px;" />
          <button id="btnImportTaxTable" class="secondary" style="margin-top:8px;">Import Tax Table from Excel</button>
          <div id="taxTableImportResult" style="margin-top:16px;"></div>
        </div>
        <div class="card" style="margin-top:16px;">
          <h3>Import Rates (JSON)</h3>
          <p class="muted small">Import rates from JSON file</p>
          <input type="file" id="ratesFileInput" accept=".json" />
          <button id="btnImportRates" class="secondary" style="margin-top:8px;">Import Rates</button>
          <div id="importResult" style="margin-top:16px;"></div>
        </div>
      </div>
    </section>

    <section id="command" class="tab">
      <div class="card command-hero">
        <h2>Strategic command center</h2>
        <p class="muted">Real-time visual cockpit combining headcount, attrition risk and payroll exposure.</p>
        <div class="command-grid">
          <div class="command-panel">
            <h3>Headcount forecast</h3>
            <canvas id="commandForecast" width="420" height="180"></canvas>
            <small class="muted">Projection uses rolling three-month trend derived from active employees.</small>
          </div>
          <div class="command-panel">
            <h3>Contract mix</h3>
            <div class="mix-bars" id="commandMix"></div>
            <h3>Attrition radar</h3>
            <ul id="commandAttrition"></ul>
          </div>
          <div class="command-panel">
            <h3>Upcoming exits</h3>
            <ul id="commandExits"></ul>
            <h3>Immediate actions</h3>
            <ul id="commandActions" class="actions"></ul>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <small>Prototype UI. Replace dummy data with your vendor integration later.</small>
  </footer>

  <!-- Employee Detail Modal -->
  <div id="employeeModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalEmployeeName">Employee Details</h2>
        <button class="modal-close" id="closeEmployeeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="empFields"></div>
        <div style="margin-top:32px;padding-top:24px;border-top:2px solid rgba(138,180,255,0.2);">
          <h3>Monthly Payroll Preview</h3>
          <p class="muted small" style="margin-bottom:16px;">View payroll calculations for any month</p>
          <div class="row" style="margin-bottom:16px;">
            <input id="empMonth" type="month" style="flex:1;max-width:200px;" />
            <button id="empPreviewBtn" class="secondary">Update Preview</button>
          </div>
          <table id="empPreviewTable">
            <thead>
              <tr>
                <th>Gross</th><th>Holiday</th><th>30% Ruling</th><th>Taxable</th><th>Net</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="5" class="muted">Loading...</td></tr>
            </tbody>
          </table>
        </div>
        <div style="margin-top:32px;padding-top:24px;border-top:2px solid rgba(138,180,255,0.2);">
          <h3>Payslip History</h3>
          <p class="muted small" style="margin-bottom:16px;">View and download payslips for this employee</p>
          <div id="employeePayslips">
            <p class="muted small">Loading payslips...</p>
          </div>
        </div>
        <div style="margin-top:32px;padding-top:24px;border-top:2px solid rgba(138,180,255,0.2);">
          <h3>Change History</h3>
          <p class="muted small" style="margin-bottom:16px;">Track all changes made to this employee record</p>
          <div id="employeeHistory">
            <p class="muted small">Loading history...</p>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="modalOverlay"></div>
  </div>

  <!-- Payslip Modal -->
  <div id="payslipModal" class="modal" hidden>
    <div class="modal-content" style="max-width:900px;">
      <div class="modal-header">
        <h2 id="payslipModalTitle">Payslip</h2>
        <button class="modal-close" id="closePayslipModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="row" style="margin-bottom:16px;">
          <button id="btnDownloadPayslip" class="success">Download PDF</button>
          <button id="btnPrintPayslip" class="secondary">Print</button>
        </div>
        <div id="payslipPdfViewer" style="border:1px solid rgba(138,180,255,0.2);border-radius:8px;padding:0;background:#ffffff;min-height:600px;overflow:auto;">
          <p class="muted" style="padding:24px;">Loading payslip...</p>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="payslipModalOverlay"></div>
  </div>

  <!-- Payroll Detail Modal -->
  <div id="payrollDetailModal" class="modal" hidden>
    <div class="modal-content" style="max-width:900px;">
      <div class="modal-header">
        <h2 id="payrollDetailModalTitle">Payroll Detail</h2>
        <button id="closePayrollDetailModal" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="payrollDetailModalContent">
          <p class="muted">Loading...</p>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="payrollDetailModalOverlay"></div>
  </div>

  <script type="module" src="/main.js"></script>
</body>
</html>
